
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Cortical graynet &#8212; graynet 0.5.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/pd.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Volumetric graynet" href="volumetric.html" />
    <link rel="prev" title="Getting started" href="getstarted.html" />
    <script type="text/javascript" src="_static/pd.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

  </head><body>
    <div id="header">
        <h1>graynet 0.5.4 documentation</h1>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
        <ul>
            <li class="nav-item nav-item-0"><a href="index.html">graynet 0.5.4 documentation</a> &#187;
            </li>
        </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<section id="cortical-graynet">
<h1>Cortical graynet<a class="headerlink" href="#cortical-graynet" title="Permalink to this heading">¶</a></h1>
<p>For the cortical stream of processing, <code class="docutils literal notranslate"><span class="pre">graynet</span></code> relies on outputs from Freesurfer processing. If you processed your data (to produce thickness values), just resample them on fsaverage atlas and store it in a format readable by <code class="docutils literal notranslate"><span class="pre">nibabel</span></code> package.</p>
<p>The following steps should help you get started and going quickly:</p>
<blockquote>
<div><ul class="simple">
<li><p>Ensure Freesurfer processing is complete. Check <a class="reference internal" href="#run-fs"><span class="std std-ref">How to run Freesurfer</span></a> for more details</p></li>
<li><p>Ensure you ran <code class="docutils literal notranslate"><span class="pre">recon-all</span></code> with <code class="docutils literal notranslate"><span class="pre">-qcache</span></code> flag choosing atleast one FWHM value (10 is the default). If not already run, it is quick to rerun on existing Freesurfer processing. See <a class="reference internal" href="#qcache-flag"><span class="std std-ref">Qcache recon-all flag</span></a> for more details</p></li>
<li><p>It is <strong>highly</strong> recommended that you perform quality control on the Freesurfer outputs before you use them for analysis. Such QC is quite easy now using <a class="reference external" href="https://raamana.github.io/visualqc/readme.html">visualqc</a>.</p></li>
</ul>
</div></blockquote>
<p>If graynet is installed without error, you should have <code class="docutils literal notranslate"><span class="pre">graynet</span></code> command in your path. Just type <code class="docutils literal notranslate"><span class="pre">graynet</span></code> and you should see it display options and usage instructions, as presented in <a class="reference internal" href="usage_cli.html"><span class="doc">Command line interface</span></a> page.</p>
<p>Suppose say</p>
<blockquote>
<div><ul class="simple">
<li><p>you already have Freesurfer processing done at <code class="docutils literal notranslate"><span class="pre">/work/project/freesurfer_reconall</span></code></p></li>
<li><p>for 5 subjects with identifiers are stored in subject_ids.txt (one per line)</p></li>
<li><p>you want to analyze network features based on cortical thickness values, which have been resampled on fsaverage surface (which is the default) at smoothing level of FWHM 10 (default)</p></li>
<li><p>use the <code class="docutils literal notranslate"><span class="pre">manhattan</span></code> method to compute histogram distance between two cortical ROIs (assuming all subjects resampled to same atlas)</p></li>
<li><p>and store the networks extracted in /work/project/graynet</p></li>
</ul>
</div></blockquote>
<p>You could achieve it all with a single command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/work/project
graynet<span class="w"> </span>-s<span class="w"> </span>subject_ids.txt<span class="w"> </span>-f<span class="w"> </span>freesurfer_thickness<span class="w"> </span>-i<span class="w"> </span>/work/project/freesurfer_reconall<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-w<span class="w"> </span>manhattan<span class="w"> </span>-a<span class="w"> </span>fsaverage<span class="w"> </span>-p<span class="w"> </span><span class="m">10</span><span class="w"> </span>-o<span class="w"> </span>/work/project/graynet
</pre></div>
</div>
<p>That’s it! By the time you can get your coffee or stretch your legs, you should have graynet processing done.</p>
<p>Suppose, you prefer to analyze ROIs as defined by a multimodal parcellation published in Glasser 2016 atlas and also curious to try multiple weight metrics -  <code class="docutils literal notranslate"><span class="pre">chebyshev</span></code> and <code class="docutils literal notranslate"><span class="pre">cosine</span></code>, you can achieve it via the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/work/project
graynet<span class="w"> </span>-s<span class="w"> </span>subject_ids.txt<span class="w"> </span>-f<span class="w"> </span>freesurfer_thickness<span class="w"> </span>-i<span class="w"> </span>/work/project/freesurfer_reconall<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-w<span class="w"> </span>manhattan<span class="w"> </span>chebyshev<span class="w"> </span>cosine<span class="w"> </span>-a<span class="w"> </span>Glasser2016<span class="w"> </span>-p<span class="w"> </span><span class="m">10</span><span class="w"> </span>-o<span class="w"> </span>/work/project/graynet
</pre></div>
</div>
<p>You could also study curvature and sulcal depth features by simply adding more features to the <code class="docutils literal notranslate"><span class="pre">-f</span></code>, such as <code class="docutils literal notranslate"><span class="pre">freesurfer_curv</span></code> and <code class="docutils literal notranslate"><span class="pre">freesurfer_sulc</span></code>.</p>
<section id="using-a-different-atlas">
<h2>Using a different Atlas<a class="headerlink" href="#using-a-different-atlas" title="Permalink to this heading">¶</a></h2>
<p>when you want to use a different atlas, you must have already processed and resampled the desired features in that atlas space, with a separate <code class="docutils literal notranslate"><span class="pre">mgh</span></code> file for each atlas. For example, when you run Freesurfer’s <code class="docutils literal notranslate"><span class="pre">QCache</span></code> with <code class="docutils literal notranslate"><span class="pre">fsaverage</span></code> atlas, you would see the files with the following pattern  <code class="docutils literal notranslate"><span class="pre">?h.thickness.fwhm10.fsaverage.mgh</span></code> in the <code class="docutils literal notranslate"><span class="pre">surf</span></code> folder of the subject’s Freesurfer output (e.g. in <code class="docutils literal notranslate"><span class="pre">$SUBJECTS_DIR/$SUBID</span></code>).</p>
<p>If you want to use a different atlas such as <code class="docutils literal notranslate"><span class="pre">glasser2016</span></code>, graynet expects to see files of the pattern <code class="docutils literal notranslate"><span class="pre">?h.thickness.fwhm10.glasser2016.mgh</span></code>. The <code class="docutils literal notranslate"><span class="pre">glasser2016</span></code> atlas distributed with graynet is already in vertex-wise correspondence with <code class="docutils literal notranslate"><span class="pre">fsaverage</span></code>, so you can simply add symbolic links (with <code class="docutils literal notranslate"><span class="pre">symlink</span></code> command in Unix variants of the OS) for <code class="docutils literal notranslate"><span class="pre">?h.thickness.fwhm10.glasser2016.mgh</span></code> to point to <code class="docutils literal notranslate"><span class="pre">?h.thickness.fwhm10.fsaverage.mgh</span></code> as a workaround.</p>
<p>That said, if you use a slightly different version of Glasser atlas or something else say <code class="docutils literal notranslate"><span class="pre">XYZ42</span></code> e.g. by pointing <code class="docutils literal notranslate"><span class="pre">--atlas</span></code> argument to a Freesurfer folder (say <code class="docutils literal notranslate"><span class="pre">/work/atlases/XYZ42/freesurfer_parc</span></code>) that may not be in vertex-wise correspondence with fsaverage, you need to run the Qcache properly and produce the corresponding features files resampled on the space of <code class="docutils literal notranslate"><span class="pre">XYZ42</span></code> and the files must be named accordingly: <code class="docutils literal notranslate"><span class="pre">?h.thickness.fwhm10.XYZ42.mgh</span></code>. Note I used fwhm as 10 here for illustrative purposes, it could be anything else you choose.</p>
</section>
<section id="processing-large-datasets-or-atlases-with-many-rois">
<h2>Processing large datasets or atlases with many ROIs<a class="headerlink" href="#processing-large-datasets-or-atlases-with-many-rois" title="Permalink to this heading">¶</a></h2>
<p>However, if you have 100s of subjects or your atlas has a large number of ROIs (like the Glasser 2016 which has 360), this computation can take a long time. It is advisable to move the processing to a larger server or computer cluster, by delegating few subjects to a single job. You could leverage this <a class="reference external" href="https://github.com/raamana/graynet/blob/master/scripts/generate_hpc_jobs.py">script</a> to process any large dataset at once (produce jobs for processing on a cluster).</p>
<blockquote>
<div><ul class="simple">
<li><p>If you have access to a computer cluster, you can submit the generated jobs to the cluster.</p></li>
<li><p>If you don’t have access to a cluster, you could still use the generated job/script files to run them locally - few at a time.</p></li>
</ul>
</div></blockquote>
<p>After processing is done (on the cluster or locally), and assuming no other errors, you should see a CSV file for each subject, with <code class="docutils literal notranslate"><span class="pre">n*(n-1)/2</span></code> values corresponding to the upper-triangular part of the connectivity matrix, where n is the number of ROIs in a atlas you chose (68 for fsaverage or 360 for Glasser2016).</p>
<p>The output folder will be graynet within <code class="docutils literal notranslate"><span class="pre">proc_dir</span></code> you choose in the script - determined by this statement in the above script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">proc_dir</span><span class="p">,</span> <span class="s1">&#39;graynet&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_fwhm</span><span class="si">{}</span><span class="s1">_range</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_nbins</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_feature</span><span class="p">,</span> <span class="n">atlas</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span>
                                            <span class="n">edge_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">))</span>
</pre></div>
</div>
<p>which after expansion looks something like based on your choices: <code class="docutils literal notranslate"><span class="pre">/your_proc_dir/graynet/freesurfer_thickness_GLASSER2016_fwhm10_range0_5_nbins25/</span></code></p>
<p>Take a look at <a class="reference internal" href="extra_scripts.html"><span class="doc">Convenience/useful scripts</span></a> also.</p>
</section>
<section id="computing-roi-wise-statistics">
<span id="roi-stats-ctx"></span><h2>Computing ROI-wise statistics<a class="headerlink" href="#computing-roi-wise-statistics" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">graynet</span></code> also helps you compute ROI-wise statistics (individual, not pair-wise) for visualization (median thickness in PCG), as well as to serve as a baseline for network-level features. Use the <code class="docutils literal notranslate"><span class="pre">-r</span></code> or <code class="docutils literal notranslate"><span class="pre">--roi_stats</span></code> flag to achieve it. Only one type of processing (ROI stats, or network-level features) can be done at a time.</p>
</section>
<section id="how-to-run-freesurfer">
<span id="run-fs"></span><h2>How to run Freesurfer<a class="headerlink" href="#how-to-run-freesurfer" title="Permalink to this heading">¶</a></h2>
<p>If you are new to Freesurfer, please:</p>
<blockquote>
<div><ul class="simple">
<li><p>follow this <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/FreeSurferBeginnersGuide">beginners guide</a></p></li>
<li><p>leverage various <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all">options</a> available</p></li>
<li><p>include <code class="docutils literal notranslate"><span class="pre">-qcache</span></code> flag choosing atleast one FWHM value (10 is the default) - see <a class="reference internal" href="#qcache-flag"><span class="std std-ref">Qcache recon-all flag</span></a>.</p></li>
<li><p>process the subjects till “recon-all is finished without error”</p></li>
</ul>
</div></blockquote>
<p>In typical scenarios (when T1 mri scans do not <em>special</em> processing to handle any artefacts), running Freesurfer would boil down to running command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>recon-all<span class="w"> </span>-all<span class="w"> </span>-sd<span class="w"> </span>/project/processed/freesurfer<span class="w"> </span>-subjid<span class="w"> </span>ABC_0001<span class="w"> </span>-i<span class="w"> </span>/project/raw/ABC_0001/mri.nii<span class="w"> </span>-qcache
</pre></div>
</div>
</section>
<section id="qcache-recon-all-flag">
<span id="qcache-flag"></span><h2>Qcache recon-all flag<a class="headerlink" href="#qcache-recon-all-flag" title="Permalink to this heading">¶</a></h2>
<p>The Qcache recon-all flag does the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>resample data (e.g. thickness, curv, sulc) onto the average subject (called fsaverage)</p></li>
<li><p>smooth it at a range of FWHM (full-width/half-max) values, usually 0, 5, 10, 15, 20, and 25mm.</p></li>
</ul>
</div></blockquote>
<p>We encourage the use of default behaviour (simple inclusion of <code class="docutils literal notranslate"><span class="pre">-qcache</span></code>), which will smooth the surface data for thickness, curv, sulc, area and jacobian_white at 0, 5, 10, 15, 20, and 25 mm FWHM.</p>
<p>If you already have a completed run of Freesurfer, you can use the following command to run the <code class="docutils literal notranslate"><span class="pre">-qcache</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>recon-all<span class="w"> </span>-s<span class="w"> </span><span class="nv">$SUBJECT_ID</span><span class="w"> </span>-qcache
</pre></div>
</div>
<p>which will run it with default parameters i.e. all measures available such as thickness, curvature, sulcal depth, area and the like. In addition, the default behaviour is to smooth them at 5mm FWHM to 25mm FWHM in steps of 5mm. You can control for a fewer combinations (e.g. one measure and one smoothing level) with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>recon-all<span class="w"> </span>-s<span class="w"> </span><span class="nv">$SUBJECT_ID</span><span class="w"> </span>-qcache<span class="w"> </span>-measure<span class="w"> </span>thickness<span class="w"> </span>-fwhm<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
<p>If you are interested in resampling the data on to a different atlas or process features outside Freesurfer structure, check <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/qcache">https://surfer.nmr.mgh.harvard.edu/fswiki/qcache</a> for more info.</p>
<p>The parcellation for the <a class="reference external" href="http://www.nature.com/nature/journal/vaop/ncurrent/full/nature18933.html">Glasser et al 2016</a> atlas has been resampled onto the fsaverage space already, courtesy of <a class="reference external" href="https://figshare.com/articles/HCP-MMP1_0_projected_on_fsaverage/3498446">Kathryn Mills</a>.</p>
<p>If you run into any issues, or have a feature you would like, please let me know here <a class="reference external" href="https://github.com/raamana/graynet/issues/new">by opening an issue</a>.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Cortical graynet</a><ul>
<li><a class="reference internal" href="#using-a-different-atlas">Using a different Atlas</a></li>
<li><a class="reference internal" href="#processing-large-datasets-or-atlases-with-many-rois">Processing large datasets or atlases with many ROIs</a></li>
<li><a class="reference internal" href="#computing-roi-wise-statistics">Computing ROI-wise statistics</a></li>
<li><a class="reference internal" href="#how-to-run-freesurfer">How to run Freesurfer</a></li>
<li><a class="reference internal" href="#qcache-recon-all-flag">Qcache recon-all flag</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="getstarted.html"
                          title="previous chapter">Getting started</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="volumetric.html"
                          title="next chapter">Volumetric graynet</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cortical.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Pradeep Reddy Raamana.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>